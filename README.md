# Dualfisheye - Gstreamer Plugin

This is gstreamer filter plugin to convert from dualfisheye video image to equirectangular format designated for RICOH THETA S 360deg camera.  

This plugin is generated by using `gst-element-maker` script.

## How to Use

### install dependency

install gstreamer, gstreamer-dev, opencv4, cmake, meson, ninja.

### clone & build

```
git clone https://github.com/kozokomiya/dualfisheye.git
cd dualfisheye
./build.sh
```

`./build.sh` will generate mapping matrix files (`xmap.npy` and `ymap.npy`) for dualfisheye -> equirectangular conversion and build the gstreamer plugin in `./build` folder. 

### sample image playback for test

```
./testsrc.sh
```

Please check the script for more information.

### video capture from THETA S -> convert to equirectangular -> display

```
./start.sh
```

### video capture from THETA S -> convert to equirectangular -> vp8 encode -> to other host via rtp

```
export GST_PLUGIN_PATH='$(WORKDIR)/dualfisheye/build'
export HOST=xx.xx.xx.xx
export PORT=8001
gst-launch-1.0 -v \
  v4l2src device=/dev/video0 ! \
  image/jpeg,width=1280,height=720 ! \
  jpegdec ! \
  videoconvert ! \
  dualfisheye ! \
  videoconvert ! \
  vp8enc deadline=1 ! \
  rtph264pay pt=96 ! \
  udpsink host=${HOST} port=${PORT}
```



This plugin only support 1280x720 resolution and RGBx/RGBA format.

[src/numpy.hpp](https://gist.github.com/rezoo/5656056) was written by Rezoo.